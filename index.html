<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¸ AI è©•åˆ†ä½ çš„ç…§ç‰‡~!!!</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* ------ CSS ç¾åŒ–è¨­å®š (å¤§å¹…æ›´æ–°) ------ */
        :root {
            --primary: #4f46e5;         /* ä¸»è‰²èª¿ï¼šé›è— */
            --primary-light: #eef2ff;   /* ä¸»è‰²æ·¡è‰² */
            --bg: #f0f4f8;              /* èƒŒæ™¯è‰² */
            --card-bg: #ffffff;         /* å¡ç‰‡èƒŒæ™¯ */
            --text-dark: #1f2937;       /* æ·±è‰²æ–‡å­— */
            --text-medium: #4b5563;     /* ä¸­ç­‰æ–‡å­— */
            --text-light: #9ca3af;      /* æ·ºè‰²æ–‡å­— */
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --border-color: #e2e8f0;

            /* å‹•æ…‹åˆ†æ•¸é¡è‰² (æœƒè¢« JS è¦†å¯«) */
            --score-color-high: #22c55e; /* é«˜åˆ†ç¶  */
            --score-color-mid: #f59e0b;  /* ä¸­åˆ†é»ƒ */
            --score-color-low: #ef4444;  /* ä½åˆ†ç´… */
        }

        body {
            font-family: 'Noto Sans TC', 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.6;
        }

        .app-container {
            background: var(--card-bg);
            width: 100%;
            max-width: 450px; /* ç¨å¾®æ”¾å¤§å®¹å™¨ */
            padding: 2.5rem;
            border-radius: 28px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: all 0.4s ease-in-out;
            transform-style: preserve-3d; /* å•Ÿç”¨ 3D è®Šæ› */
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 2.5rem;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }

        /* 1. ä¸Šå‚³å€å¡Š (å¼·åŒ–è¦–è¦ºèˆ‡äº’å‹•) */
        .upload-zone {
            border: 3px dashed var(--border-color);
            border-radius: 20px;
            padding: 3.5rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
            position: relative;
            overflow: hidden;
        }
        .upload-zone:hover {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(var(--primary), 0.15);
        }
        .upload-zone:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .upload-icon {
            font-size: 4rem; /* æ”¾å¤§åœ–ç¤º */
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: block;
            animation: bounceIn 0.8s ease-out; /* æ–°å¢å‹•ç•« */
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .upload-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        .upload-subtext {
            font-size: 0.9rem;
            color: var(--text-medium);
        }
        #fileInput { display: none; }

        /* 2. è¼‰å…¥å‹•ç•« (å¼·åŒ–è¦–è¦º) */
        .loading-zone {
            display: none;
            padding: 3rem 0;
            animation: fadeIn 0.5s ease-out;
        }
        .spinner {
            width: 50px; height: 50px; /* æ”¾å¤§ */
            border: 5px solid #e2e8f0;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-medium);
            margin-bottom: 0.5rem;
        }
        .loading-subtext {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* 3. çµæœå±•ç¤ºå€ (å¤§å¹…å„ªåŒ–) */
        .result-zone {
            display: none;
            animation: slideUpIn 0.6s ease-out forwards;
            position: relative; /* ç”¨æ–¼æˆªåœ– */
            padding-bottom: 0; /* è®“å…§å®¹æ›´ç·Šæ¹Š */
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUpIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* ç…§ç‰‡å®¹å™¨ */
        .image-wrapper {
            width: 100%;
            margin-bottom: -40px; /* è®“åˆ†æ•¸åœ“åœˆç–Šåœ¨ç…§ç‰‡ä¸Š */
            position: relative;
            z-index: 1;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); /* å¼·åŒ–é™°å½± */
            border-radius: 16px;
        }
        .preview-img {
            width: 100%;
            border-radius: 16px; /* åœ“è§’èˆ‡å®¹å™¨ä¸€è‡´ */
            display: block;
            object-fit: cover; /* ç¢ºä¿åœ–ç‰‡ä¸è®Šå½¢ */
            max-height: 250px; /* é™åˆ¶é«˜åº¦ */
        }

        /* åˆ†æ•¸åœ“åœˆ + ä¸­æ–‡åˆ†æ•¸å®¹å™¨ */
        .score-display-group {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1.8rem;
        }
        .score-circle {
            width: 110px; height: 110px; /* æ”¾å¤§åˆ†æ•¸åœˆ */
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0%, #e2e8f0 0%);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 6px 15px rgba(0,0,0,0.25); /* æ›´å¼·é™°å½± */
            background-color: white; /* ç¢ºä¿èƒŒæ™¯ä¸é€æ˜ */
            border: 4px solid white; /* è®“åˆ†æ•¸åœˆæœ‰ç«‹é«”æ„Ÿ */
        }
        .score-inner {
            width: 90px; height: 90px;
            background: #fff;
            border-radius: 50%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .score-val {
            font-size: 2.8rem; /* æ”¾å¤§åˆ†æ•¸æ•¸å­— */
            font-weight: 800;
            color: var(--primary);
            line-height: 1;
        }
        .score-label {
            font-size: 0.85rem;
            color: var(--text-medium);
            margin-top: 5px;
            letter-spacing: 0.5px;
        }
        
        /* ä¸­æ–‡åˆ†æ•¸æ¨£å¼ (å­—é«”æœ€å¤§) */
        .grade-display {
            margin-top: 20px; /* æ‹‰é–‹èˆ‡æ•¸å€¼åˆ†æ•¸çš„è·é›¢ */
            padding: 10px 25px; /* æ”¾å¤§ padding */
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 30px; /* æ›´åœ“æ½¤ */
            font-size: 1.8rem; /* **å¤§å¹…æ”¾å¤§** */
            font-weight: 700;
            letter-spacing: 2px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            animation: popIn 0.5s ease-out 0.3s backwards; /* å»¶é²å½ˆå…¥ */
        }
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        /* è©•èª */
        .comment-box {
            background: #f1f5f9;
            padding: 1.5rem;
            border-radius: 18px;
            margin-bottom: 2rem; /* å¢åŠ èˆ‡æŒ‰éˆ•çš„è·é›¢ */
            text-align: left;
            font-size: 1rem; /* ç¨å¾®æ”¾å¤§ */
            line-height: 1.7;
            color: var(--text-dark);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
        }
        .comment-box strong {
            color: var(--primary);
            font-weight: 700;
            display: block;
            margin-bottom: 0.5rem;
        }

        /* æŒ‰éˆ•ç¾¤ */
        .btn-group {
            display: flex;
            gap: 12px; /* å¢åŠ é–“è· */
            margin-top: 2rem;
        }
        .btn {
            flex: 1;
            padding: 14px 20px; /* æ”¾å¤§æŒ‰éˆ• */
            border: none;
            border-radius: 12px;
            font-size: 1.05rem; /* æ”¾å¤§å­—é«” */
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .btn-share {
            background: var(--primary);
            color: white;
            position: relative;
            overflow: hidden;
        }
        .btn-share::after { /* æŒ‰éˆ•é»æ“Šæ³¢ç´‹æ•ˆæœ */
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: scale(0);
            transition: transform 0.4s ease-out;
            opacity: 0;
            top: 50%;
            left: 50%;
        }
        .btn-share:active::after {
            transform: scale(2);
            opacity: 1;
        }

        .btn-retry {
            background: var(--border-color);
            color: var(--text-dark);
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        .btn-share:hover { background: #3730a3; } /* é»æ“Šæ™‚é¡è‰²æ›´æ·± */
        .btn-retry:hover { background: #cbd5e1; }
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* é®ç½©ï¼Œç”¨æ–¼æˆªåœ–æ™‚éš±è—æŒ‰éˆ• */
        .screenshot-mask {
            position: absolute;
            bottom: -2rem; /* ç¨å¾®è¶…å‡ºå®¹å™¨ï¼Œç¢ºä¿é®ä½æŒ‰éˆ• */
            left: -2.5rem; /* æ“´å¤§åˆ°å®¹å™¨ padding ä¹‹å¤– */
            right: -2.5rem; /* æ“´å¤§åˆ°å®¹å™¨ padding ä¹‹å¤– */
            height: 8rem; /* æ ¹æ“šæŒ‰éˆ•é«˜åº¦å’Œé–“è·èª¿æ•´ */
            background-color: var(--card-bg); /* èˆ‡å®¹å™¨èƒŒæ™¯è‰²ä¸€è‡´ */
            z-index: 100; /* ç¢ºä¿é®è“‹ä½æŒ‰éˆ• */
            display: none; /* é è¨­éš±è— */
            border-radius: 0 0 28px 28px; /* åº•éƒ¨åœ“è§’ */
        }
        /* ç•¶é€²è¡Œæˆªåœ–æ™‚é¡¯ç¤ºé®ç½© */
        .app-container.screenshot-mode .screenshot-mask {
            display: block;
        }

    </style>
</head>
<body>

    <div class="app-container" id="appContainer">
        <h1>ğŸ“¸ ç…§ç‰‡ç¾å­¸è©•åˆ†</h1>

        <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
            <span class="upload-icon">â¬†ï¸</span>
            <p class="upload-text">é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ç…§ç‰‡</p>
            <p class="upload-subtext">AI å°‡æ¨¡æ“¬è©•é‘‘æ‚¨çš„æ”å½±ä½œå“</p>
            <input type="file" id="fileInput" accept="image/*" onchange="processImage(event)">
        </div>

        <div class="loading-zone" id="loadingZone">
            <div class="spinner"></div>
            <p class="loading-text">æ­£åœ¨åˆ†æç…§ç‰‡ç¾å­¸èˆ‡æ§‹åœ–...</p>
            <p class="loading-subtext">é€™å¯èƒ½éœ€è¦å¹¾ç§’é˜ï¼Œè«‹ç¨å€™</p>
        </div>

        <div class="result-zone" id="resultZone">
            <div class="image-wrapper">
                <img id="displayImage" class="preview-img" src="" alt="User Photo">
            </div>

            <div class="score-display-group">
                <div class="score-circle" id="scoreCircleBg">
                    <div class="score-inner">
                        <span class="score-val" id="scoreText">0</span>
                        <span class="score-label">åˆ†æ•¸</span>
                    </div>
                </div>
                
                <div class="grade-display" id="chineseGradeDisplay">--</div>
            </div>

            <div class="comment-box">
                <strong>ğŸ§  æ¨¡æ“¬ AI è©•èªï¼š</strong>
                <span id="commentText">è©•èªè¼‰å…¥ä¸­...</span>
            </div>

            <div class="btn-group">
                <button class="btn btn-share" onclick="shareResult()">ğŸš€ åˆ†äº«è©•åˆ†</button>
                <button class="btn btn-retry" onclick="resetApp()">â™»ï¸ å†æ¬¡è©•åˆ†</button>
            </div>
            <div class="screenshot-mask"></div>
        </div>
    </div>

    <script>
        // ------ JavaScript é‚è¼¯ ------

        // 1. ä¸­æ–‡åˆ†æ•¸è½‰æ›é‚è¼¯
        function getChineseGrade(score) {
            if (score >= 95) return 'ç”²ä¸Š';
            if (score >= 90) return 'ç”²';
            if (score >= 85) return 'ç”²ä¸‹';
            if (score >= 80) return 'ä¹™ä¸Š';
            if (score >= 75) return 'ä¹™';
            if (score >= 70) return 'ä¹™ä¸‹';
            return 'ä¸™';
        }

        // 2. æ¨¡æ“¬è©•èª (å¤šçµ„è®ŠåŒ–)
        const comments = {
            'ç”²ä¸Š': [
                "ç°¡ç›´æ˜¯è—è¡“å“ï¼å…‰ç·šã€æ§‹åœ–ã€æ„å¢ƒç„¡å¯æŒ‘å‰”ï¼Œå®Œç¾é§•é¦­æ”å½±çš„ç²¾é«“ï¼",
                "é€™ä¸æ˜¯ç…§ç‰‡ï¼Œé€™æ˜¯è¦–è¦ºé¥—å®´ï¼è¶…è¶ŠæœŸå¾…çš„å‚‘ä½œï¼Œæ¯ä¸€æ¬¡ç´°çœ‹éƒ½æ˜¯äº«å—ã€‚",
                "æ§‹åœ–å¦‚è©©ï¼Œå…‰å½±å¦‚ç•«ï¼Œç¬é–“æ•æ‰æ°¸æ†ã€‚ç”²ä¸Šï¼Œç•¶ä¹‹ç„¡æ„§ï¼",
                "AI éƒ½é©šå˜†çš„å®Œç¾ä½œå“ï¼Œè«‹æ¥å—æœ€å´‡é«˜çš„æ•¬æ„ã€‚"
            ],
            'ç”²': [
                "éå¸¸ç²¾é‡‡çš„æ”å½±ä½œå“ï¼Œæ§‹åœ–èˆ‡æ°›åœæŒæ¡å¾—çˆç«ç´”é’ï¼Œæ·±å…·ç¾æ„Ÿï¼",
                "ç´°ç¯€è±å¯Œï¼Œè‰²å½©é£½å’Œï¼Œè¦–è¦ºè¡æ“ŠåŠ›åè¶³ã€‚å€¼å¾—ç´°ç´°å“å‘³ã€‚",
                "å¹³è¡¡æ„Ÿæ¥µä½³ï¼Œå±•ç¾äº†æ”å½±å¸«å°ç¾çš„ç¨åˆ°çœ¼å…‰ï¼Œéå¸¸æ£’ï¼",
                "å¹¾ä¹æ˜¯æ»¿åˆ†ä½œå“ï¼Œåªå·®ä¸€é»é»å¤©é¦¬è¡Œç©ºçš„éˆæ„Ÿå°±èƒ½è¶…è¶Šã€‚"
            ],
            'ç”²ä¸‹': [
                "è¡¨ç¾åŠ›å¼·ï¼Œå·²æ˜¯å„ªç§€ä¹‹ä½œã€‚å†å¤šä¸€é»é»å·§æ€å°±èƒ½æ›´ä¸Šä¸€å±¤æ¨“ï¼",
                "ç•«é¢æ„Ÿå¾ˆæ£’ï¼Œå…‰å½±é‹ç”¨å¾—å®œï¼Œç•¥æœ‰å°ç‘•ç–µä½†ä¸å½±éŸ¿æ•´é«”è³ªæ„Ÿã€‚",
                "çœ‹å¾—å‡ºç”¨å¿ƒï¼Œé¢¨æ ¼ç¨ç‰¹ã€‚ç¹¼çºŒåŠ æ²¹ï¼Œæ½›åŠ›ç„¡é™ï¼",
                "ç¾å­¸è§€å¿µæ¸…æ™°ï¼Œåªæ˜¯å°‘äº†é‚£éº¼ä¸€é»é»ä»¤äººé©šè±”çš„ç¬é–“ã€‚"
            ],
            'ä¹™ä¸Š': [
                "ç•«é¢æ•´æ½”ï¼Œä¸»é¡Œæ˜ç¢ºã€‚å¦‚æœèƒ½åœ¨å…‰ç·šæˆ–è§’åº¦ä¸Šå¤§è†½å˜—è©¦ï¼Œæœƒæ›´å¥½ã€‚",
                "æ•´é«”æ„Ÿè¦ºèˆ’é©ï¼Œä½†ç¼ºä¹ä»¤äººå°è±¡æ·±åˆ»çš„äº®é»ã€‚",
                "åŸºæœ¬åŠŸç´®å¯¦ï¼Œä½†ç¼ºä¹æƒ…æ„Ÿæ·±åº¦æˆ–å‰µæ„æ€è€ƒï¼Œå»ºè­°å¤šè§€å¯Ÿã€‚",
                "æ‹å¾—é‚„ä¸éŒ¯å•¦ï¼Œè‡³å°‘æˆ‘çœ‹å¾—æ‡‚é€™æ˜¯ä»€éº¼ã€‚"
            ],
            'ä¹™': [
                "é€™å¼µç…§ç‰‡é‚„è¡Œï¼Œä½†æœ‰äº›å…ƒç´ åˆ†æ•£äº†æ³¨æ„åŠ›ï¼Œæ§‹åœ–å¯ä»¥å†ç²¾ç°¡äº›ã€‚",
                "å…‰ç·šæˆ–è‰²å½©è™•ç†ç•¥é¡¯å¹³æ·¡ï¼Œæœªèƒ½å……åˆ†ç™¼æ®ä¸»é¡Œæ½›åŠ›ã€‚",
                "æœ‰å¾…æå‡ï¼Œå¤šè§€å¯Ÿå„ªç§€ä½œå“æœƒå¾ˆæœ‰å¹«åŠ©ã€‚",
                "ä¸­è¦ä¸­çŸ©ï¼Œæ²’æœ‰çŠ¯å¤§éŒ¯ï¼Œä½†ä¹Ÿæ²’ç•™ä¸‹æ·±åˆ»å°è±¡ã€‚"
            ],
            'ä¹™ä¸‹': [
                "ç•«é¢æœ‰äº›é›œäº‚ï¼Œä¸»é¡Œä¸å¤ çªå‡ºã€‚å»ºè­°å…ˆå­¸ç¿’åŸºæœ¬çš„æ§‹åœ–æ³•å‰‡ã€‚",
                "æ›å…‰æˆ–å°ç„¦å¯èƒ½å­˜åœ¨å•é¡Œï¼Œç´°ç¯€å‘ˆç¾ä¸è¶³ã€‚",
                "å‰µæ„æœ‰ï¼Œä½†åŸ·è¡ŒåŠ›æœ‰å¾…åŠ å¼·ã€‚è«‹å¤šåŠ ç·´ç¿’ã€‚",
                "æ„Ÿè¦ºåƒæ˜¯éš¨æ‰‹ä¸€æ‹ï¼Ÿå—¯... è‡³å°‘é¡è‰²æ˜¯å½©è‰²çš„ã€‚"
            ],
            'ä¸™': [
                "é€™... è—è¡“æ˜¯ä¸»è§€çš„ï¼Œæˆ‘å€‘é‚„æ˜¯æ›å¼µç…§ç‰‡ä¾†çœ‹çœ‹å§ï¼Ÿ",
                "çœ‹ä¾†é€™å¼µç…§ç‰‡èˆ‡ç¾å­¸è©•åˆ†ç³»çµ±ç·£åˆ†å°šæ·ºï¼Œå»ºè­°é‡æ–°å¯©è¦–ä¸»é¡Œèˆ‡å…‰ç·šã€‚",
                "å—¯ï¼Œå˜—è©¦æ˜¯å¥½çš„ï¼Œä½†å»ºè­°å¾é›¶é–‹å§‹å­¸ç¿’æ”å½±åŸºç¤ï¼ŒåŠ æ²¹ï¼",
                "AI ä¹Ÿè©çª®äº†ï¼Œæˆ‘åªèƒ½èªªé€™æ˜¯ä¸€å¼µç…§ç‰‡ã€‚"
            ]
        };

        function getSimulatedComment(grade) {
            const possibleComments = comments[grade] || comments['ä¸™']; // ç¢ºä¿æœ‰é è¨­å€¼
            return possibleComments[Math.floor(Math.random() * possibleComments.length)];
        }


        // 3. è™•ç†åœ–ç‰‡èˆ‡æ¨¡æ“¬è©•åˆ†
        async function processImage(event) {
            const file = event.target.files[0];
            if (!file) return;

            // UI åˆ‡æ›ï¼šé¡¯ç¤º Loading
            document.getElementById('uploadZone').style.display = 'none';
            document.getElementById('loadingZone').style.display = 'block';

            // åœ–ç‰‡é è¦½
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('displayImage').src = e.target.result;

                // æ¨¡æ“¬è™•ç†æ™‚é–“ (2-4ç§’)
                const processingTime = Math.floor(Math.random() * 2000) + 2000; // 2000ms ~ 4000ms
                setTimeout(() => {
                    // éš¨æ©Ÿç”¢ç”Ÿåˆ†æ•¸ (30-100)
                    const score = Math.floor(Math.random() * 71) + 30; // è®“åˆ†æ•¸åˆ†ä½ˆåœ¨ 30-100 ä¹‹é–“æ›´çœŸå¯¦
                    const chineseGrade = getChineseGrade(score);
                    
                    const aiResult = {
                        score: score,
                        comment: getSimulatedComment(chineseGrade) // æ ¹æ“šä¸­æ–‡åˆ†æ•¸çµ¦è©•èª
                    };

                    showResult(aiResult);
                }, processingTime); 
            };
            reader.readAsDataURL(file);
        }
        
        // 4. é¡¯ç¤ºçµæœå‹•ç•«
        function showResult(data) {
            document.getElementById('loadingZone').style.display = 'none';
            document.getElementById('resultZone').style.display = 'block';

            const score = data.score;
            const chineseGrade = getChineseGrade(score);

            document.getElementById('scoreText').innerText = score;
            document.getElementById('chineseGradeDisplay').innerText = chineseGrade;
            document.getElementById('commentText').innerText = data.comment;

            // åœ“ç’°é¡è‰²èˆ‡æ¨£å¼ (æ ¹æ“šåˆ†æ•¸è®ŠåŒ–)
            let color;
            if (score >= 85) color = 'var(--score-color-high)'; // é«˜åˆ†ç¶ 
            else if (score >= 70) color = 'var(--score-color-mid)'; // ä¸­åˆ†é»ƒ
            else color = 'var(--score-color-low)'; // ä½åˆ†ç´…
            
            document.getElementById('scoreText').style.color = color;
            document.getElementById('chineseGradeDisplay').style.background = `color-mix(in srgb, ${color} 20%, white)`; // ç”¨ CSS color-mix ç”¢ç”Ÿæ·¡è‰²èƒŒæ™¯
            document.getElementById('chineseGradeDisplay').style.color = color;
            
            const deg = score * 3.6;
            document.getElementById('scoreCircleBg').style.background = 
                `conic-gradient(${color} ${deg}deg, #e2e8f0 0deg)`;
        }

        // 5. åˆ†äº«åŠŸèƒ½ (ä½¿ç”¨ html2canvas æˆªåœ–)
        async function shareResult() {
            const appContainer = document.getElementById('appContainer');
            const shareButton = document.querySelector('.btn-share');
            const retryButton = document.querySelector('.btn-retry');
            const screenshotMask = document.querySelector('.screenshot-mask');

            // 1. éš±è—æŒ‰éˆ•ï¼Œé¡¯ç¤ºé®ç½© (ç‚ºäº†æˆªåœ–æ™‚ç•«é¢ä¹¾æ·¨)
            retryButton.style.opacity = '0';
            shareButton.style.opacity = '0';
            appContainer.classList.add('screenshot-mode'); // å•Ÿç”¨é®ç½©

            // ç¢ºä¿å…ƒç´ éš±è—å®Œç•¢
            await new Promise(r => setTimeout(r, 100)); 
            
            // 2. ä½¿ç”¨ html2canvas æˆªåœ–
            html2canvas(appContainer, {
                useCORS: true, // ç¢ºä¿åœ–ç‰‡å¯ä»¥è¢«æ­£ç¢ºæˆªåœ– (å¦‚æœåœ–ç‰‡æ˜¯å¤–éƒ¨é€£çµéœ€è¦)
                scale: 2, // æé«˜è§£æåº¦
                logging: false, // é—œé–‰ console log
                backgroundColor: null, // è®“èƒŒæ™¯é€æ˜ï¼Œèˆ‡ body èƒŒæ™¯ä¸€è‡´
            }).then(canvas => {
                // 3. æˆªåœ–å®Œæˆï¼Œæ¢å¾©æŒ‰éˆ•
                retryButton.style.opacity = '1';
                shareButton.style.opacity = '1';
                appContainer.classList.remove('screenshot-mode'); // ç¦ç”¨é®ç½©

                // 4. è½‰æ›ç‚ºåœ–ç‰‡ä¸¦æä¾›ä¸‹è¼‰/åˆ†äº«
                const image = canvas.toDataURL("image/png");
                
                // å˜—è©¦ä½¿ç”¨åŸç”Ÿåˆ†äº« API (é€šå¸¸åœ¨æ‰‹æ©Ÿä¸Š)
                if (navigator.share) {
                    canvas.toBlob(function(blob) {
                        const file = new File([blob], 'AI_Photo_Rating.png', { type: 'image/png' });
                        navigator.share({
                            files: [file],
                            title: 'æˆ‘çš„ç…§ç‰‡ AI è©•åˆ†çµæœï¼',
                            text: `æˆ‘çš„ç…§ç‰‡ç²å¾— ${document.getElementById('scoreText').innerText} åˆ† (${document.getElementById('chineseGradeDisplay').innerText})ï¼å¿«ä¾†è©¦è©¦ï¼š${window.location.href}`
                        }).catch(error => console.log('åˆ†äº«å¤±æ•—', error));
                    }, 'image/png');
                } else {
                    // å¦‚æœä¸æ”¯æ´åŸç”Ÿåˆ†äº« (é€šå¸¸åœ¨é›»è…¦ä¸Š)ï¼Œå‰‡ä¸‹è¼‰åœ–ç‰‡
                    const link = document.createElement('a');
                    link.download = 'AI_Photo_Rating.png';
                    link.href = image;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    alert('è©•åˆ†çµæœåœ–ç‰‡å·²ä¸‹è¼‰ï¼');
                }
            }).catch(error => {
                console.error("æˆªåœ–å¤±æ•—:", error);
                // æˆªåœ–å¤±æ•—ä¹Ÿè¦æ¢å¾©æŒ‰éˆ•
                retryButton.style.opacity = '1';
                shareButton.style.opacity = '1';
                appContainer.classList.remove('screenshot-mode');
                alert('æˆªåœ–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            });
        }

        // 6. é‡ç½® (å†æ¬¡è©•åˆ†)
        function resetApp() {
            document.getElementById('resultZone').style.display = 'none';
            document.getElementById('loadingZone').style.display = 'none';
            document.getElementById('uploadZone').style.display = 'block';
            document.getElementById('fileInput').value = ''; // æ¸…ç©ºå·²é¸æª”æ¡ˆ
        }

        // æ‹–æ›³ä¸Šå‚³åŠŸèƒ½ (ç‚ºç¾åŒ–ä¸Šå‚³ç•«é¢å¢åŠ )
        const uploadZone = document.getElementById('uploadZone');
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = var(--primary);
            uploadZone.style.backgroundColor = var(--primary-light);
        });
        uploadZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = var(--border-color);
            uploadZone.style.backgroundColor = '#fff';
        });
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = var(--border-color);
            uploadZone.style.backgroundColor = '#fff';
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('fileInput').files = files;
                processImage({ target: { files: files } });
            }
        });

    </script>
</body>
</html>
